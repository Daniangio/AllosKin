# SA Debug Plots: How to Interpret

This document explains the plots generated by `scripts/debug_sa_init.py --analyze` and how to interpret the metrics.

## Concepts

**Read**  
One independent simulated-annealing run that produces one sample.

**Sweep**  
One full update pass over all variables during a read. More sweeps = more annealing time per read.

**Init vs Final**  
Each read starts from an initial state (warm-start from MD or random), then SA evolves it to a final state.

## Plot layout (per schedule)

Each schedule (auto or a specific hot/cold pair) generates one figure with 4 panels:

1) **Final mean energy (top-left)**  
   - **Line + markers**: mean energy across reads.  
   - **Error bars**: standard deviation across reads.  
   - **Vertical min–max bars**: min/max across reads.  
   What it tells you:
   - Lower is better (deeper minima).
   - Large std/min–max means high variability between reads.
   - If mean rises above init energies, SA is drifting away from the warm start.

2) **Init mean energy (top-right)**  
   Same statistics as above, but for the **initial states** used for those runs.
   Useful to confirm that warm-start or top‑k actually provided lower-energy starts.

3) **Hamming mean (bottom-left)**  
   Average number of residues that changed between init and final (per read).  
   - **Low Hamming**: SA stays close to the init (good for preserving warm starts).  
   - **High Hamming**: SA “forgets” the init and explores elsewhere.

4) **Energy correlation (bottom-right)**  
   Pearson correlation between **init energy per read** and **final energy per read**.  
   - **High positive correlation**: better init energies tend to stay better after SA.  
   - **Near zero**: SA final energies are mostly independent of init (warm starts are being forgotten).  
   - **Negative**: unusual; indicates SA may be flipping ordering of initial energies.

## How to read schedule effects

If you compare sweeps on the same schedule:
- Increasing sweeps should generally lower the final mean energy or stabilize it.
- If final energies **increase** with sweeps, the schedule is too hot (not cold enough) or too short.

If you compare schedules:
- Lower **hot** and higher **cold** usually preserve warm starts better and reach lower energies.
- If warm-start and random curves overlap, SA is effectively ignoring the init (too hot/too short).

## Typical failure modes

1) **Warm-start != better final**  
   If warm-start init energy is much lower than random, but final energies are similar:
   - Schedule is too hot or too short.
   - Increase sweeps and/or cold beta.

2) **Top‑k ≈ independent**  
   If top‑k restarts don’t improve final energy:
   - SA is forgetting init (check Hamming and correlation).
   - Or top‑k pool is not actually much better than baseline.

## Recommendations for exploration

Try a small grid to find schedules that actually improve minima:
- **Sweeps**: 200, 1000, 5000  
1) **Hot**: 0.05, 0.1  
2) **Cold**: 50, 100, 200  

Then select schedules where:
- Final mean energy is **lower** than random and warm-start,
- Hamming is **lower** (init preserved), and
- Energy correlation is **positive**.

## Notes

- Energies reported are those of the Potts model (not QUBO), after decoding.  
- If you use `repair=argmax`, invalid QUBO samples are coerced to valid label assignments; this can mask some constraint violations.
